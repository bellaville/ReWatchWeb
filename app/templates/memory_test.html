{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/memory_test.css') }}">

<div class="container text-center mt-5">
    <h2>Short-Term Memory Test</h2>

    <!-- flash message confirmation for instructions -->
    {% with messages = get_flashed_messages(category_filter=["memory_test"]) %}
        {% if messages %}
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                {{ messages[0] }}
                <hr>
                <button id="confirm-no" class="btn btn-danger">No</button>
                <button id="confirm-yes" class="btn btn-success">Yes</button>
            </div>
        {% endif %}
    {% endwith %}

    <!-- memory test frame hidden initially -->
    <div id="test-frame" class="{{ 'visible' if show_test else 'hidden' }}">
        <h2>Round {{ round_num }}</h2>
        <div id="shapes-frame">
            {% for shape in shapes %}
                <div class="shape {{ shape }}" 
                    style="background-color: {{ shape_colours[loop.index0] }};
                    top: {{ shape_positions[loop.index0].top }}px;
                    left: {{ shape_positions[loop.index0].left }}px;">
                </div>
            {% endfor %}
        </div>

        {% if buttons_enabled %}
            <form method="POST" action="{{ url_for('main.memory_test') }}">
                <button type="submit" name="choice" value="Same" class="btn btn-success btn-lg">Same</button>
                <button type="submit" name="choice" value="Different" class="btn btn-danger btn-lg">Different</button>
            </form>
        {% endif %}
    </div>
</div>

<script>
    const yesBtn = document.getElementById('confirm-yes');
    const noBtn = document.getElementById('confirm-no');
    const testFrame = document.getElementById('test-frame');
    const alertBox = yesBtn ? yesBtn.parentElement : null;

    if (yesBtn) {
        yesBtn.addEventListener('click', function() {
            // hide instructions
            alertBox.style.display = 'none';
            // reveal memory test frame
            testFrame.style.display = 'block';
            // start memorization phase (5s pause)
            window.location.href = "{{ url_for('main.memory_memorize') }}";
        });
    }

    if (noBtn) {
        noBtn.addEventListener('click', function() {
            window.location.href = "{{ url_for('main.assessments') }}";
        });
    }
</script>
{% endblock %}
